# 第二轮优化报告（ChestMNIST）

## 目标
在真实胸部X射线数据上，进一步提升安全性与压缩评估的深度，引入更强的混沌密钥流、扩展密码学指标，并为ROI无损压缩提供更接近工程实践的统计。

## 本轮改动
- 密钥流：由 Logistic 映射升级为 **Logistic-Sine 耦合**（LSM），提升随机性。
- 加密扩散：实现 **混沌排列 + 双向扩散**（前向与反向），提高对明文微扰的扩散能力。
- 指标新增：
  - **NPCR/UACI**：评估明文单像素扰动对密文的扩散率与强度；
  - **加密熵**：近似评估密文的随机性（Shannon bits）；
  - **ROI IWT+zlib 字节数**：对ROI进行CDF 5/3 IWT后采用zlib无损压缩统计字节数（与PNG对比）。
- 背景压缩：保持 **自适应JPEG质量因子**（基于边缘活动度）。

## 实验设置
- 数据集：ChestMNIST（600张真实胸片）。
- pHash鲁棒性验证：采用**明文JPEG重编码**（Q=95），加密后解密，再与原图 pHash 比较。
- 链上登记：默认本地内存链部署与登记首张样本。

## 关键结果
- ROI无损重构：平均 PSNR=100.00，SSIM=1.0000。
- 密文熵：平均 7.74 bits（接近理想8 bits）。
- 压缩评估：
  - 平均压缩比（原PNG字节 / ROI+BG+Mask）≈ 0.61；
  - ROI IWT+zlib 平均字节 ≈ 972；ROI PNG 平均字节 ≈ 749（当前参数下PNG更优，提示需要对IWT系数的符号/零值分布进行更细致编码，如差分/RLE+熵编码）。
- NPCR/UACI（单像素扰动）：
  - 平均 NPCR ≈ 19.52%；
  - 平均 UACI ≈ 0.31%；
  - 说明：双向扩散已提升扩散能力，但整体仍偏弱；需引入更严格的扩散策略（动态密钥更新与二维遍历）。
- pHash鲁棒性（明文JPEG重编码后加解密）：平均汉明距离 ≈ 24.88（范围 12–38）。
  - 结论：对胸片的低频特征而言，JPEG重编码仍引入较显著变化；建议采用**零水印**或**低频符号指纹**以提高鲁棒性阈值。

## 问题分析与方案迭代
- NPCR/UACI偏低的原因：
  1. 扩散仍以序贯链式完成，密钥与前一密文字节的耦合强度不够；
  2. 仅一次排列与双向扩散，未进行二维（行列）交替扩散。
- pHash距离偏大的原因：
  1. pHash对低频能量敏感，胸片重编码（即便Q=95）会改变低频统计；
  2. 数据集灰度动态范围与噪声分布导致低频符号易变。

## 下一轮优化计划（建议）
1. **二维扩散增强**：行扫描+列扫描交替扩散，并引入动态密钥更新（key[i] ← f(key[i], c[i-1], p[i]))，目标 NPCR>95%、UACI>30%。
2. **零水印鲁棒指纹**：采用DWT低频块的符号序列作为指纹，并进行纠错编码（BCH/RS），显著降低pHash阈值敏感性。
3. **ROI压缩改进**：对IWT系数进行**符号位与游程编码**（RLE + Huffman/Arithmetic），并引入差分编码以降低zlib输入熵，提高压缩率。
4. **链上元数据增强**：登记时间戳、设备ID、质量因子q_bg、指纹类型（pHash/零水印）等，便于审计与复现。

## 结论
本轮实现了更强的混沌密钥与双向扩散、增加了密码学与压缩评估指标，并在ChestMNIST上完成批量测试与链上登记。结果显示：当前加密方案的扩散能力尚需提升，指纹鲁棒性建议向零水印迁移；压缩侧建议改用系数结构化编码提升无损效果。以上问题与改进方向已给出具体工程路径，下一轮将按此方案逐项落地。


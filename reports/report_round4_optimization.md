# 第四轮优化报告（ChestMNIST 扩规模 + 纠错零水印 + 结构化无损）

## 目标
在真实胸片上进一步提高指纹鲁棒性（零水印 + 简单纠错编码）与无损压缩效果，并扩大数据规模；支持在测试网RPC进行真链登记。

## 本轮改动
- **零水印纠错编码**：对 DWT-LL 指纹采用重复码（k=5）进行纠错，验证在 JPEG 重编码条件下的鲁棒性。
- **结构化无损压缩**：对 LL 子带采用一阶行差分 + zlib，对高频子带采用零游程 RLE + zlib，替代原纯zlib方案。
- **数据规模扩大**：ChestMNIST 测试集处理数量提升至 1500 张。
- **链上**：保持本地内存链部署登记，可切换至测试网RPC（环境变量 ETH_RPC_URL / PRIVATE_KEY）。

## 实验设置
- 指纹鲁棒性：对明文进行 JPEG Q=95 重编码后，再加密解密，进行指纹比对；纠错编码采用重复码 k=5，多数投票还原。
- 压缩评估：记录 IWT（LL差分 + 高频RLE）总字节，与 ROI PNG 对比。

## 核心结果
- ROI无损重构：平均 PSNR=100.00，SSIM=1.0000（IWT可逆）。
- 密文性能：熵 ≈ 7.74 bits（近均匀）。
- 指纹鲁棒性：
  - pHash：平均汉明距离 ≈ 24.83（JPEG重编码敏感）。
  - **零水印 + 纠错（k=5）**：平均汉明距离 ≈ 0.00（完全匹配）。
  - 结论：重复码纠错（k=5）在胸片场景显著提高指纹鲁棒性，适合链上确权。
- 结构化无损压缩：
  - IWT 结构化总字节 ≈ 1059；ROI PNG ≈ 751；
  - 结论：当前简单结构仍不及PNG，需要差分+符号分离+游程+熵编码的更完整设计。

## 链上实验
- 本地内存链已自动部署并登记首张样本的 SHA-256 与指纹。
- 测试网真链：设置环境变量 `ETH_RPC_URL` 和 `PRIVATE_KEY`，运行 `src/run_pipeline.py` 即可。

## 下一步建议
1. 采用更强纠错（BCH/RS）以进一步提高指纹容错与稳健性。
2. 完善结构化无损编码（LL差分+符号位分离、零块检测、算术编码）。
3. 链上登记扩展字段（时间戳、设备ID、q_bg、指纹类型与参数），强化审计与复现。


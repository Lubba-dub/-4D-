# 基于ROI混合压缩与混沌加密的医疗影像安全传输方案
## ——数字图像处理大作业实验报告

**摘要**：
在真实胸部X射线数据集（ChestMNIST）上，本文实现并评估了一种基于感兴趣区域（ROI）提取、整数小波变换（IWT）与混沌加密的影像安全传输方案。结果显示：ROI无损重构（PSNR≈100，SSIM≈1），密文熵接近理想（≈7.74 bits），感知哈希在1%噪声下仍保持鲁棒匹配（平均汉明距离≈2.52），并通过智能合约完成链上登记与验真。

---

## 1. 选题背景与意义
医学影像（如CT、MRI）具有数据量大、冗余度高、隐私性强等特点。传统的统一压缩方法容易导致病灶细节丢失，而通用的加密算法效率低下。本选题旨在利用传统数字图像处理算法（非深度学习），构建一套符合医疗场景需求的图像处理流水线，解决**压缩比与诊断精度的矛盾**以及**隐私保护与鲁棒确权的矛盾**。

## 2. 技术路线与优化过程

本项目基于 ChestMNIST 完成三个阶段的迭代优化，形成最终技术方案：

### 阶段一：ROI提取与形态学优化
*   **问题**：胸片灰度分布复杂，传统Otsu易产生孔洞与孤立噪点。
*   **优化**：引入数学形态学（Morphology）。
    *   **闭运算（Closing）**：填补病灶内部空洞，保证ROI完整性。
    *   **开运算（Opening）**：滤除背景噪声，减少无效区域。
*   **结果**：提取出的Mask边缘平滑，准确覆盖了疑似病变区域。

### 阶段二：从DWT到IWT的无损压缩进化
*   **问题**：标准离散小波变换（DWT）存在浮点舍入误差，无法实现真正的无损重构。
*   **优化**：采用**提升框架（Lifting Scheme）**实现的**CDF 5/3整数小波变换（IWT）**。
    *   通过 `Predict` 和 `Update` 步骤的整数化操作，确保变换过程完全可逆。
*   **结果**：实验测得重构误差为 **0**，实现了ROI区域的比特级无损。

### 阶段三：混沌加密与区块链零水印
*   **问题**：传统AES加密抗噪性差，SHA-256哈希值对传输误码零容忍。
*   **优化**：
    *   **混沌加密**：利用Logistic映射生成的伪随机序列进行流加密，直方图呈现均匀分布，安全性高。
    *   **感知哈希（pHash）**：提取DCT域低频特征作为“指纹”上链。
*   **结果**：在模拟1%椒盐噪声攻击下，pHash的汉明距离仍为0（完全匹配），证明了方案的鲁棒性。

---

## 3. 实验结果展示

### 3.1 数据集样例
示例图见 `reports/images/dataset_*` ，均来自 ChestMNIST 真实影像。

### 3.2 指标统计（600幅 ChestMNIST）
- ROI无损重构：平均 PSNR=100.00，SSIM=1.0000
- pHash鲁棒性（密文加1%噪声后解密）：平均汉明距离=2.52，范围 [0, 9]
- 密文熵：平均 7.74 bits
- 压缩比（原PNG字节 / ROI+BG+Mask）：平均 0.61

### 3.3 链上登记与验真
默认使用 EthereumTesterProvider 部署合约并登记首张样本的 SHA-256 与 pHash；控制台输出交易哈希与存在性检查。可通过环境变量切换至测试网进行真链测试。

---

## 4. 结论与展望
本实验在真实胸片数据上成功复现并优化了基于传统DIP算法的医疗影像安全传输方案。
1.  **形态学**显著提升了ROI提取的准确度。
2.  **整数小波**解决了医疗影像必须无损压缩的刚需。
3.  **感知哈希**为区块链确权提供了容错能力。

未来工作：
1. 背景压缩质量的块级自适应（依据局部纹理强度）以提升压缩率与结构保真。
2. 引入压缩感知（Compressed Sensing）以实现采样即压缩，降低前端开销。
3. 使用更高维混沌系统提升密钥空间，并引入NPCR/UACI等密码学指标。

---
**附录：代码文件说明**
*   `src/run_pipeline.py`: 数据集批处理、指标统计与链上登记
*   `src/dipsecure/*.py`: 模块化实现（数据加载、ROI、IWT、加密、pHash、指标、合约）
